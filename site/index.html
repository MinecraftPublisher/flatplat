<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="viewport" content="width=device-width"> <!-- Enter your title in between the title tags -->
	<title>FlatPlat</title> <!-- Connecting this HTML file to the CSS tylesheet -->
	<link href="style.css" rel="stylesheet" type="text/css" />
	<link href="https://flatplat-server.martiaforoud.repl.co/images/circle.png" rel="favicon">
	</link>
	<link href="https://flatplat-server.martiaforoud.repl.co/images/circle.png" rel="shortcut icon">
	</link>
	<link href="https://flatplat-server.martiaforoud.repl.co/images/circle.png" rel="apple-touch-icon">
	</link>
	<script src="/socket.io/dist/socket.io.js">
	</script> <!-- Libraries: -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.1/socket.io.js">

	</script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js">

	</script>
	<script src="collision.js">

	</script>
	<script>
		//https://flatplat-server.martiaforoud.repl.run
		//send => data
		//recieve => player
		var name = "guest";
var socket;
var lasttime = "";

function start(){
	if(document.getElementById("name").value == null){
		alert("Please enter a username.");
	}
	else {
		init();
	}
}

function init(){
	console.log("Init");
	setTimeout(function(){
		document.getElementById("joinform").style.display = "none";
		setTimeout(function(){
			initt();
		},500);
	},1000);
}

function initt() {
		document.getElementById("player").removeAttribute("style");
		import("./main.js");
	socket = io();
    document.getElementById("player").innerHTML = "<br>" + document.getElementById("name").value;
    name = document.getElementById("name").value;
    socket.on('connect', () => {
        setInterval(update, 10);
        console.log("Connected to the server");
        socket.on("player", function(top) {
            let date_ob = new Date();
            let date = ("0" + date_ob.getDate()).slice(-2);
            let month = ("0" + (date_ob.getMonth() + 1)).slice(-2);
            let year = date_ob.getFullYear();
            let hours = date_ob.getHours();
            let minutes = date_ob.getMinutes();
            let seconds = date_ob.getSeconds();
            if (top.indexOf(name) > -1 || top.indexOf(lasttime) < 0) {} else {
                var before = document.getElementById("multi-div").innerHTML;
                document.getElementById("multi-div").innerHTML += top;
            }
        });
        socket.on("disconnect", function() {
            console.log("Disconnected from the server.");
        });
        socket.on("servertime", function(time) {
            lasttime = time;
            Array.prototype.slice.call(document.getElementsByTagName('a')).forEach(function(item) {
                if (item.innerHTML.includes(time)) {} else {
                    item.remove();
                }
            });
        });
    });
}

function particlize(){
	document.getElementById("particle-container").innerHTML += "<div class='particle'></div>";
}

function update() {
    socket.emit("time");
    var element = document.getElementById('player'),
        style = window.getComputedStyle(element),
        top = style.getPropertyValue('top');
    left = style.getPropertyValue('left');
    var bruh = "<a><div class='" + name + "' id='player2' style='-moz-border-radius: 60px; -webkit-border-radius: 60px; border-radius: 60px;color: red; text-align: center;font-family: \"Comic Sans MS\", \"Comic Sans\", cursive;color: rgb(170, 154, 125);top: " + top + ";left: " + left + ";position: absolute;background-color: rgb(255, 245, 227);border: 5px solid rgb(255, 210, 127);width: 100px;height: 100px'><br>" + name + "</div><div id='time' style='display: none'>PUT_DATE_HERE</div><a/>";
    socket.emit("data", bruh);
}
		var myVar;
	</script>
</head>

<body style="margin:0;">
	<script>
	setInterval(particlize,3000);
	</script>
	<div id="particle-container" style="width: 100%;height: 100%;">
	<div class="particle"></div>
	<div class='particle'></div>
	<div class='particle'></div>
	<div class='particle'></div>
	<div class="particle"></div>
	<div class='particle'></div>
	<div class='particle'></div>
	<div class='particle'></div>
</div>
	<!--<div id="loader"></div>-->
	<div id="multi-div"></div>
	<!--<div id="object" class="object" style="width: 100%;height: 10%;bottom: 50px;left: 0px;color: red;background-color: green;"></div>-->
	<div class="shouldHide" id="joyDiv" style="width:200px;height:200px;margin-bottom:20px;bottom: 20px;left: 60px;position: fixed;"></div>
	<div class="shouldHide" id="player" style="display: none;"></div> 
	<div class="box">
	<form id="joinform">
		<span class="text-center">Join the flatplat party</span>
	<div class="input-container">
		<input id="name" type="text" required/>
		<label>Enter a username</label>		
		<button onclick="start();" type="button" class="btn">Join</button>
	</div>
</form>	
</div>
	<script src="joy.js"></script>
	<!--<script src="main.js"></script>-->
</body>

</html>